---
title: "Expand broom::tidy() output for categorical parameter estimates"
# subtitle: Learn how to build animated chord diagrams in R
# summary: ðŸ‘‹ We know that first impressions are important
date: '2020-07-08'
draft: false
featured: false
authors:
- admin
tags:
- Academic
image:
  preview_only: true
categories: 
  - R
  - "r-bloggers"
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<div>
<img src="featured.png" width="200px" align="right">
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The <code>tidycat</code> package includes the <code>tidy_categorical()</code> function to expand <code>broom::tidy()</code> outputs for categorical parameter estimates.</p>
</div>
<div id="documentation" class="section level2">
<h2>Documentation</h2>
<p>For full documentation, see the package vignette: <a href="https://cran.r-project.org/web/packages/tidycat/vignettes/intro.html">The tidycat package: expand broom::tidy() output for categorical parameter estimates</a></p>
</div>
<div id="hello-world" class="section level2">
<h2>Hello World</h2>
<p>The <code>tidy()</code> function in the broom package takes the messy output of built-in functions in R, such as <code>lm()</code>, and turns them into tidy data frames.</p>
<pre class="r"><code>library(dplyr)
library(broom)

m1 &lt;- mtcars %&gt;%
  mutate(transmission = recode_factor(am, `0` = &quot;automatic&quot;, `1` = &quot;manual&quot;)) %&gt;%
  lm(mpg ~ transmission + wt *  as.factor(cyl), data = .)

tidy(m1)</code></pre>
<pre><code>## # A tibble: 7 x 5
##   term               estimate std.error statistic       p.value
##   &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 (Intercept)          41.5        4.54     9.14  0.00000000190
## 2 transmissionmanual   -0.902      1.51    -0.595 0.557        
## 3 wt                   -6.19       1.65    -3.75  0.000937     
## 4 as.factor(cyl)6      -8.66      10.4     -0.836 0.411        
## 5 as.factor(cyl)8     -16.9        5.27    -3.20  0.00374      
## 6 wt:as.factor(cyl)6    2.12       3.40     0.625 0.538        
## 7 wt:as.factor(cyl)8    3.84       1.77     2.17  0.0399</code></pre>
<p>The <code>tidy_categorical()</code> function adds</p>
<ul>
<li>further columns (<code>variable</code>, <code>level</code> and <code>effect</code>) to the <code>broom::tidy()</code> output to help manage categorical variables</li>
<li>further rows for reference category terms and a column to indicate their location (<code>reference</code>) when setting <code>include_reference = TRUE</code> (default)</li>
</ul>
<p>It requires two inputs</p>
<ul>
<li>a data frame <code>d</code> of parameter estimates from a model from <code>broom::tidy()</code></li>
<li>the corresponding model object <code>m</code> passed to <code>broom::tidy()</code></li>
</ul>
<p>For example:</p>
<pre class="r"><code>library(tidycat)
d1 &lt;- m1 %&gt;%
  tidy(conf.int = TRUE) %&gt;%
  tidy_categorical(m = m1)
d1 %&gt;%
  select(-(3:5))</code></pre>
<pre><code>## # A tibble: 10 x 8
##    term      estimate conf.low conf.high variable    level  effect  reference   
##    &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;       &lt;fct&gt;  &lt;chr&gt;   &lt;chr&gt;       
##  1 (Interce~   41.5     32.1       50.8  (Intercept) (Inte~ main    Non-Baselin~
##  2 &lt;NA&gt;         0        0          0    transmissi~ autom~ main    Baseline Ca~
##  3 transmis~   -0.902   -4.02       2.22 transmissi~ manual main    Non-Baselin~
##  4 wt          -6.19    -9.59      -2.79 wt          wt     main    Non-Baselin~
##  5 &lt;NA&gt;         0        0          0    as.factor(~ 4      main    Baseline Ca~
##  6 as.facto~   -8.66   -30.0       12.7  as.factor(~ 6      main    Non-Baselin~
##  7 as.facto~  -16.9    -27.7       -6.00 as.factor(~ 8      main    Non-Baselin~
##  8 &lt;NA&gt;         0        0          0    wt:as.fact~ 4      intera~ Baseline Ca~
##  9 wt:as.fa~    2.12    -4.87       9.12 wt:as.fact~ 6      intera~ Non-Baselin~
## 10 wt:as.fa~    3.84     0.192      7.50 wt:as.fact~ 8      intera~ Non-Baselin~</code></pre>
<p>The expanded data frame from <code>tidy_categorical()</code> of parameter estimates can be particularly useful for creating coefficient plots, allowing:</p>
<ul>
<li>grouping terms from the same categorical variable from the additional columns.</li>
<li>inclusion of reference categories in a coefficient plot from the additional rows, allowing the reader to better grasp the meaning of the parameter estimates in each categorical variable.</li>
</ul>
<p>For example:</p>
<pre class="r"><code>library(forcats)
library(ggplot2)
library(ggforce)

d1 %&gt;%
  slice(-1) %&gt;%
  mutate(variable = fct_inorder(variable)) %&gt;%
  ggplot(mapping = aes(x = level, y = estimate, colour = reference,
                       ymin = conf.low, ymax = conf.high)) +
  facet_row(facets = &quot;variable&quot;, scales = &quot;free_x&quot;, space = &quot;free&quot;) +
  geom_hline(yintercept = 0, linetype = &quot;dashed&quot;) +
  geom_pointrange()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-3-1.png" width="768" /></p>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>You can install the released version of tidycat from <a href="https://CRAN.R-project.org">CRAN</a> with:</p>
<pre class="r"><code>install.packages(&quot;tidycat&quot;)</code></pre>
<p>And the development version from <a href="https://github.com/">GitHub</a> with:</p>
<pre class="r"><code># install.packages(&quot;devtools&quot;)
devtools::install_github(&quot;guyabel/tidycat&quot;)</code></pre>
</div>
