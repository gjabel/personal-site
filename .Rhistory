ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age, fill = year, colour = year)) +
geom_col(position = "identity", alpha = 0.5) +
scale_x_continuous(labels = abs) +
labs(x = "Populaton", y = "Age", fill = "Year") +
scale_color_manual(values = c("1950" = "black", "2020" = "red")) +
scale_fill_manual(values = c("1950" = NA, "2020" = "red"))
blogdown:::preview_site(startup = TRUE)
library(tidyverse)
library(wpp2019)
data(popF)
data(popM)
d <- popM %>%
mutate(sex = "Male") %>%
bind_rows(popF) %>%
replace_na(list(sex = "Female")) %>%
pivot_longer(cols = "1950":"2020", names_to = "year", values_to = "pop") %>%
mutate(age = fct_inorder(age),
pop = pop/1e3,
year = as.integer(year))
d
d %>%
filter(name == "World",
year == 1950) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age, fill = sex)) +
geom_col() +
scale_x_continuous(labels = abs) +
labs(x = "Populaton", y = "Age", fill = "Sex")
d %>%
filter(name == "World",
year %in% c(1950, 1985, 2020)) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age, fill = sex)) +
facet_wrap(facets = "year") +
geom_col() +
scale_x_continuous(labels = abs) +
labs(x = "Populaton", y = "Age", fill = "Sex")
d %>%
filter(name == "World",
year %in% c(1950, 2020)) %>%
arrange(rev(year)) %>%
mutate(year = as.character(year)) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age, fill = year)) +
geom_col(position = "identity") +
scale_x_continuous(labels = abs) +
labs(x = "Populaton", y = "Age", fill = "Year")
d %>%
filter(name == "World",
year %in% c(1950, 2020)) %>%
arrange(rev(year)) %>%
mutate(year = as.character(year)) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age, fill = year)) +
geom_col(position = "dodge") +
scale_x_continuous(labels = abs) +
labs(x = "Populaton", y = "Age", fill = "Year")
library(ADRItools)
levels(d$age)
y_lab <- every_other(levels(d$age))
y_lab
d %>%
filter(name == "World",
year == 1950) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age, fill = sex)) +
geom_col() +
scale_x_continuous(labels = abs) +
scale_y_discrete(breaks = y_lab) +
labs(x = "Populaton", y = "Age", fill = "Sex")
d %>%
filter(name == "World",
year == 1950) %>%
mutate(age = as.numeric(age)) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age, fill = sex)) +
geom_col(orientation = "y") +
scale_x_continuous(labels = abs) +
scale_y_continuous(
breaks = every_other(1:nlevels(d$age)),
labels = y_lab,
sec.axis = dup_axis()) +
labs(x = "Populaton", y = "Age", fill = "Sex")
d %>%
filter(name == "World",
year == 1950) %>%
mutate(age = as.numeric(age)) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age, fill = sex)) +
geom_col(orientation = "y") +
scale_x_continuous(labels = abs) +
scale_y_continuous(
breaks = every_other(1:nlevels(d$age)),
labels = every_other(levels(d$age)),
sec.axis = sec_axis(trans = ~(. * -5 + min(d$year) + 5),
name = "Year of Birth")) +
labs(x = "Populaton", y = "Age", fill = "Sex")
library(ggpol)
d %>%
filter(name == "World",
year == 1950) %>%
mutate(sex = fct_rev(sex)) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age)) +
geom_col() +
facet_share(facets = "sex", scales = "free_x") +
scale_x_continuous(labels = abs) +
labs(x = "", y = "") +
theme(axis.text.y = element_text(hjust = 0.5))
d %>%
filter(name == "World",
year == 1950) %>%
mutate(sex = fct_rev(sex)) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age)) +
geom_col() +
facet_share(facets = "sex", scales = "free_x") +
scale_x_continuous(labels = abs) +
labs(x = "", y = "") +
theme(axis.text.y = element_blank(),
# axis.ticks = element_blank(),
panel.spacing = unit(0, "lines"))
d %>%
filter(name == "World",
year == 1950) %>%
mutate(sex = fct_rev(sex)) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age)) +
geom_col()
g1 <- d %>%
filter(name == "World",
year == 1950,
sex == "Male") %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age)) +
geom_col() +
scale_x_continuous(labels = abs,
expand = expansion(mult = c(0.05, 0))) +
labs(x = "Male", y = "") +
theme(plot.margin = unit(c(1, -1, 0.5, 1), "lines"))
g1
g2 <- d %>%
filter(name == "World",
year == 1950,
sex != "Male") %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age)) +
geom_col() +
scale_x_continuous(labels = abs, expand = expansion(mult = c(0, 0.05))) +
labs(x = "Female", y = "") +
theme(axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
plot.margin = unit(c(1, 1, 0.5, -1), "lines"))
g1 + g2
g2
library(patchwork)
g1 + g2
d %>%
filter(name == "World",
year == 1950,
sex != "Male") %>%
mutate(age = fct_inorder(f = age),
pop = ifelse(test = sex == "Male", yes = pop, no = pop)) %>%
ggplot(mapping = aes(x = pop, y = age, fill = edu)) +
geom_col() +
scale_x_symmetric(labels = abs) +
theme_bw()
library(lemon)
d %>%
filter(name == "World",
year == 1950,
sex != "Male") %>%
mutate(age = fct_inorder(f = age),
pop = ifelse(test = sex == "Male", yes = pop, no = pop)) %>%
ggplot(mapping = aes(x = pop, y = age, fill = edu)) +
geom_col() +
scale_x_symmetric(labels = abs) +
theme_bw()
d %>%
filter(name == "World",
year == 1950,
sex != "Male") %>%
mutate(age = fct_inorder(f = age),
pop = ifelse(test = sex == "Male", yes = pop, no = pop)) %>%
ggplot(mapping = aes(x = pop, y = age)) +
geom_col() +
scale_x_symmetric(labels = abs) +
theme_bw()
d %>%
filter(name == "World",
year == 1950) %>%
mutate(age = fct_inorder(f = age),
pop = ifelse(test = sex == "Male", yes = pop, no = pop)) %>%
ggplot(mapping = aes(x = pop, y = age)) +
geom_col() +
scale_x_symmetric(labels = abs) +
theme_bw()
d
d %>%
filter(name == "World",
year == 1950) %>%
mutate(sex = fct_rev(sex),
pop = ifelse(test = sex == "Male", yes = pop, no = pop)) %>%
ggplot(mapping = aes(x = pop, y = age))
d %>%
filter(name == "World",
year == 1950) %>%
mutate(sex = fct_rev(sex),
pop = ifelse(test = sex == "Male", yes = pop, no = pop))
d %>%
filter(name == "World",
year == 1950) %>%
mutate(sex = fct_rev(sex),
pop = ifelse(test = sex == "Male", yes = -pop, no = pop)) %>%
ggplot(mapping = aes(x = pop, y = age)) +
geom_col() +
scale_x_symmetric(labels = abs) +
theme_bw()
d %>%
filter(name == "World",
year == 1950) %>%
mutate(sex = fct_rev(sex),
pop = ifelse(test = sex == "Male", yes = -pop, no = pop)) %>%
ggplot(mapping = aes(x = pop, y = age)) +
geom_col() +
scale_x_symmetric(labels = abs) +
theme_bw() +
coord_cartesian(clip = 'off', ylim = c(1, length(unique(d$age)))) +
annotate(geom = "text", x = -Inf, y = -1, label = "Male", hjust = 0) +
annotate(geom = "text", x = Inf, y = -1, label = "Female", hjust = 1) +
labs(x = "")
blogdown:::preview_site(startup = TRUE)
blogdown:::preview_site(startup = TRUE)
blogdown:::preview_site(startup = TRUE)
library(blogdown)
serve_site()
build_site()
serve_site()
build_site()
serve_site()
build_site()
serve_site()
blogdown:::preview_site(startup = TRUE)
blogdown:::preview_site()
build_site()
library(blogdown)
build_site()
serve_site()
serve_site()
blogdown:::preview_site()
build_site()
build_site()
serve_site()
build_site()
blogdown:::preview_site(startup = TRUE)
build_site()
library(blogdown)
build_site()
serve_site()
blogdown:::preview_site(startup = TRUE)
library(blogdown)
build_site()
build_site()
build_site()
blogdown:::preview_site(startup = TRUE)
library(blogdown)
build_site()
blogdown:::preview_site(startup = TRUE)
library(blogdown)
build_site()
build_site()
serve_site()
blogdown::stop_server()
blogdown::stop_server()blogdown::stop_server()
blogdown::stop_server()
blogdown::stop_server()
serve_site()
blogdown::stop_server()
serve_site()
blogdown:::preview_site(startup = TRUE)
build_site()
blogdown::build_site()
blogdown:::preview_site(startup = TRUE)
blogdown:::preview_site(startup = TRUE)
blogdown::build_site()
blogdown::build_site()
library(tidyverse)
library(wpp2019)
data(popF)
data(popM)
d <- popM %>%
mutate(sex = "Male") %>%
bind_rows(popF) %>%
replace_na(list(sex = "Female")) %>%
pivot_longer(cols = "1950":"2020", names_to = "year", values_to = "pop") %>%
mutate(age = fct_inorder(age),
pop = pop/1e3,
year = as.integer(year))
d
d %>%
filter(name == "World",
year == 1950) %>%
ggplot(mapping = aes(x = ifelse(test = sex == "Male", yes = -pop, no = pop),
y = age, fill = sex)) +
geom_col() +
scale_x_continuous(labels = abs) +
labs(x = "Populaton", y = "Age", fill = "Sex")
d %>%
filter(name == "World",
year == 1950) %>%
mutate(pop_pyr = ifelse(test = sex == "Male", yes = -pop, no = pop)) %>%
ggplot(mapping = aes(x = pop_pyr, y = age, fill = sex)) +
geom_col() +
scale_x_continuous(labels = abs) +
labs(x = "Populaton", y = "Age", fill = "Sex")
d %>%
filter(name == "World",
year == 1950) %>%
mutate(pop_pyr = ifelse(test = sex == "Male", yes = -pop, no = pop)) %>%
ggplot(mapping = aes(x = pop_pyr, y = age, fill = sex)) +
geom_col(stat = stat(count / max(count))) +
scale_x_continuous(labels = abs) +
labs(x = "Populaton", y = "Age", fill = "Sex")
d %>%
filter(name == "World",
year == 1950) %>%
mutate(pop_pyr = ifelse(test = sex == "Male", yes = -pop, no = pop)) %>%
ggplot(mapping = aes(x = pop_pyr, y = age, fill = sex)) +
geom_col(stat = stat(pop_pyr / max(pop_pyr))) +
scale_x_continuous(labels = abs) +
labs(x = "Populaton", y = "Age", fill = "Sex")
blogdown:::preview_site(startup = TRUE)
blogdown:::preview_site(startup = TRUE)
blogdown:::preview_site(startup = TRUE)
blogdown:::preview_site(startup = TRUE)
blogdown:::preview_site(startup = TRUE)
blogdown::build_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::stop_server()
blogdown::serve_site()
blogdown::serve_site()
---
title: "Animated Sankey Plots"
author: "Guy Abel"
date: '2020-03-23'
tags:
- R
- migration
- sankey
categories: null
draft: yes
header:
image: headers/sankey-ani.png
---
blogdown::serve_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::stop_server()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::build_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown:::preview_site(startup = TRUE)
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::stop_server()
blogdown::serve_site()
blogdown::build_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::stop_server()
blogdown::build_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::stop_server()
blogdown::stop_server()
blogdown::stop_server()
blogdown::build_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::stop_server()
blogdown::stop_server()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown:::preview_site()
blogdown::stop_server()
blogdown::build_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown:::preview_site()
blogdown::stop_server()
blogdown::stop_server()
blogdown::serve_site()
library(blogdown)
blogdown::serve_site()
blogdown::stop_server()
blogdown::stop_server()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::stop_server()
blogdown::serve_site()
blogdown:::preview_site(startup = TRUE)
blogdown::new_post(title ="title")
blogdown::build_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
blogdown:::preview_site(startup = TRUE)
blogdown::new_post()
blogdown::new_post("title")
blogdown::serve_site()
blogdown::stop_server()
blogdown::stop_server()
blogdown::stop_server()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::stop_server()
blogdown::build_site()
blogdown::serve_site()
blogdown:::preview_site(startup = TRUE)
blogdown::stop_server()
blogdown::build_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::build_site()
blogdown::build_site()
blogdown::build_site()
blogdown::build_site()
blogdown::build_site()
blogdown::build_site()
blogdown::build_site()
blogdown::build_site()
blogdown::build_site()
blogdown::build_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::serve_site()
.carousel-indicators > li,
.carousel-indicators > li.active{
width: 200px;
height: 35px;
border-radius: 0;
border: solid 1px grey;
background: white;
text-indent: 0;
}
.carousel-indicators > li.active {
background: #4caf50;
}
</style>
<video loop="loop" width="720" height="720" poster="/img/sankey-income/abel-free.png" controls>
<source src="/img/sankey-income/abel-free.mp4" type="video/mp4" />
</video>
blogdown::stop_server()
blogdown::build_site()
blogdown::serve_site()
blogdown::build_site()
blogdown::build_site()
blogdown:::preview_site(startup = TRUE)
blogdown::build_site()
blogdown:::preview_site(startup = TRUE)
blogdown::build_site()
blogdown:::preview_site(startup = TRUE)
blogdown::build_site()
blogdown::build_site()
blogdown:::preview_site(startup = TRUE)
blogdown::build_site()
